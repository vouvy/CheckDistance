local maxDistance = 99

local Http = game:GetService("HttpService")
local TPS = game:GetService("TeleportService")
local Api = "https://games.roblox.com/v1/games/"
local _place = game.PlaceId
local _servers = Api.._place.."/servers/Public?sortOrder=Asc&limit=100"

function ListServers(cursor)
    local url = _servers .. ((cursor and "&cursor="..cursor) or "")
    local success, response = pcall(function()
        return Http:GetAsync(url)
    end)
    if success then
        return Http:JSONDecode(response)
    else
        warn("Failed to get server list: " .. response)
        return nil
    end
end

local function HopServer()
    local Server, Next
    repeat
        local Servers = ListServers(Next)
        if Servers then
            local serverIndex = math.random(1, #Servers.data)
            Server = Servers.data[serverIndex]
            Next = Servers.nextPageCursor
        else
            warn("Failed to retrieve servers, retrying...")
            wait(1) -- Wait a bit before retrying
        end
    until Server
    TPS:TeleportToPlaceInstance(_place, Server.id, game:GetService('Players').LocalPlayer)
end

local localPlayer = game.Players.LocalPlayer

if localPlayer then
    spawn(function()
        while true do
            local localPosition = localPlayer.Character.HumanoidRootPart.Position
            local shouldHop = false

            for _, player in pairs(game.Players:GetChildren()) do
                if player ~= localPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    local targetPosition = player.Character.HumanoidRootPart.Position
                    local distance = (targetPosition - localPosition).Magnitude

                    if distance > maxDistance then
                        shouldHop = true
                        break
                    end
                end
            end

            if shouldHop then
                print("A player is beyond " .. maxDistance .. " distance. Hopping server...")
                HopServer()
                break
            else
                print("All players are within acceptable range.")
            end

            wait(3) -- Check every 3 seconds
        end
    end)
else
    print("Local player not found")
end
